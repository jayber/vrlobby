<html>
<head>
    <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="https://naf.vrlobby.co/easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe/dist/networked-aframe.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="/static/script/components.js"></script>
    <script>
        AFRAME.registerComponent('spawn-in-circle', {
            schema: {
                radius: {type: 'number', default: 1}
            },

            init: function () {
                var el = this.el;
                var center = el.getAttribute('position');

                var angleRad = this.getRandomAngleInRadians();
                var circlePoint = this.randomPointOnCircle(this.data.radius, angleRad);
                var worldPoint = {x: circlePoint.x + center.x, y: center.y, z: circlePoint.y + center.z};
                el.setAttribute('position', worldPoint);

                var angleDeg = angleRad * 180 / Math.PI;
                var angleToCenter = -1 * angleDeg + 90;
                var rotationStr = '0 ' + angleToCenter + ' 0';
                el.setAttribute('rotation', rotationStr);
            },

            getRandomAngleInRadians: function () {
                return Math.random() * Math.PI * 2;
            },

            randomPointOnCircle: function (radius, angleRad) {
                x = Math.cos(angleRad) * radius;
                y = Math.sin(angleRad) * radius;
                return {x: x, y: y};
            }
        });
    </script>
</head>
<body>

<a-scene init-environment networked-scene="
  app: {appName};
  webrtc: true;
  webrtcAudio: true;
  signalURL: naf.vrlobby.co
">
    <a-assets>
        <script id="avatar-template" type="text/html">
            <a-entity class="avatar">
                <a-sphere class="head"
                          color="#5985ff"
                          scale="0.45 0.5 0.4">

                </a-sphere>
                <a-entity class="face"
                          position="0 0.05 0"
                        >
                    <a-sphere class="eye"
                              color="#efefef"
                              position="0.16 0.1 -0.35"
                              scale="0.12 0.12 0.12"
                            >
                        <a-sphere class="pupil"
                                  color="#000"
                                  position="0 0 -1"
                                  scale="0.2 0.2 0.2"
                                ></a-sphere>
                    </a-sphere>
                    <a-sphere class="eye"
                              color="#efefef"
                              position="-0.16 0.1 -0.35"
                              scale="0.12 0.12 0.12"
                            >
                        <a-sphere class="pupil"
                                  color="#000"
                                  position="0 0 -1"
                                  scale="0.2 0.2 0.2"
                                ></a-sphere>
                    </a-sphere>
                </a-entity>
            </a-entity>
        </script>

        <a-asset-item id="table" src="/static/models/table_dae/table_dae.dae"></a-asset-item>

    </a-assets>

    <a-entity id="environment" environment="preset:japan"></a-entity>

    <a-entity id="player" networked="template:#avatar-template;showLocalTemplate:false;" camera position="0 1.3 0"
              spawn-in-circle="radius:3;" wasd-controls look-controls>
        <a-entity cursor
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                  material="color:lightgrey;shader:flat">
        </a-entity>
    </a-entity>

    <a-entity collada-model="#table" position="0 0.13 0"></a-entity>
    <a-entity collada-model="#table" position="0 0.13 2"></a-entity>
    <a-entity collada-model="#table" position="2 0.13 2"></a-entity>
    <a-entity collada-model="#table" position="2 0.13 4"></a-entity>

    <a-box depth="0.1" height="2" width="1" color="#999999" position="2 1 0" rotation="0 -45 0">
        <a-entity text="value: Environment;color:#333333;anchor:center;baseline:center;width:1.5" scale="2 2 2" position="1.1 0.75 0.05"></a-entity>

        <a-triangle switch-environment="down" color="#333" position="-0.39 0.2 0.06" side="double" scale="0.15 0.15 0.15" rotation="0 0 90"></a-triangle>
        <a-triangle switch-environment="up" color="#333" position="0.39 0.2 0.06" side="double" scale="0.15 0.15 0.15" rotation="0 0 -90"></a-triangle>
        <a-entity id="name" text="value:name;color:#55f;anchor:center;baseline:center;width:2;align:center" position="0 0.2 0.06"></a-entity>
    </a-box>


    <a-entity light="color: #ccccff; intensity: 1; type: ambient;" visible=""></a-entity>
    <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity>

</a-scene>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-104431518-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>